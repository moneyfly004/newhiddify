# 完整问题清单

## 📋 问题分类

### 🔧 一、内核部分

#### 1.1 内核启动和停止
- [x] **基础功能**：已实现基本的启动/停止
- [ ] **进程监控**：需要实现进程健康检查
- [ ] **自动重启**：进程崩溃时自动重启
- [ ] **日志收集**：收集和显示内核日志
- [ ] **资源清理**：确保资源正确释放

#### 1.2 内核配置生成
- [x] **基础转换**：已实现 Clash ↔ Sing-box 转换
- [ ] **完整配置**：根据节点和模式生成完整配置
- [ ] **节点选择**：应用用户选择的节点
- [ ] **规则生成**：根据模式生成规则配置
- [ ] **DNS 配置**：生成 DNS 配置

#### 1.3 内核切换
- [x] **基础切换**：已实现基本切换
- [ ] **无缝切换**：避免切换时断流
- [ ] **配置迁移**：自动迁移配置
- [ ] **状态同步**：同步连接状态
- [ ] **失败回滚**：切换失败时回滚

#### 1.4 内核适配器
- [ ] **统一接口**：抽象内核接口
- [ ] **Sing-box 适配器**：完整实现
- [ ] **Clash Meta 适配器**：完整实现
- [ ] **配置转换器**：完善转换逻辑

---

### 💾 二、存储部分

#### 2.1 本地数据存储
- [x] **基础存储**：已实现 StorageService
- [x] **用户信息**：已实现
- [x] **配置存储**：已实现
- [ ] **数据加密**：敏感数据加密存储
- [ ] **数据迁移**：版本升级时数据迁移

#### 2.2 配置文件管理
- [ ] **版本管理**：配置文件版本控制
- [ ] **备份恢复**：配置文件备份和恢复
- [ ] **临时文件清理**：自动清理临时文件
- [ ] **配置文件加密**：加密存储配置文件

#### 2.3 状态持久化
- [x] **连接状态**：已实现
- [x] **订阅节点**：已实现
- [ ] **自动重连**：应用重启后自动重连
- [ ] **状态恢复**：完整的状态恢复机制

---

### 🔄 三、订阅格式转换

#### 3.1 格式识别
- [x] **基础识别**：已实现 Clash/Sing-box/Unknown
- [x] **Base64 解码**：已实现
- [ ] **V2Ray 识别**：需要添加
- [ ] **更多格式**：支持更多订阅格式

#### 3.2 格式转换
- [x] **Clash → Sing-box**：已实现基础转换
- [x] **Sing-box → Clash**：已实现基础转换
- [ ] **完整协议支持**：
  - [ ] VMess/VLESS（完整）
  - [ ] Trojan（完整）
  - [ ] Shadowsocks（完整）
  - [ ] HTTP/HTTPS
  - [ ] SOCKS5
  - [ ] WireGuard

#### 3.3 高级特性转换
- [ ] **TLS 配置**：TLS 设置转换
- [ ] **WebSocket 配置**：WS 设置转换
- [ ] **HTTP/2 配置**：H2 设置转换
- [ ] **gRPC 配置**：gRPC 设置转换
- [ ] **Reality 配置**：Reality 设置转换

#### 3.4 节点解析
- [ ] **多协议解析**：支持所有协议
- [ ] **节点信息提取**：完整提取节点信息
- [ ] **节点去重**：智能去重算法
- [ ] **节点分组**：分组管理

#### 3.5 配置合并
- [ ] **多订阅合并**：合并多个订阅
- [ ] **节点去重策略**：去重算法
- [ ] **分组管理**：节点分组
- [ ] **优先级处理**：处理优先级

---

### 🔄 四、自动更新订阅

#### 4.1 定时更新机制
- [x] **基础更新**：已实现 SubscriptionUpdater
- [x] **定时任务**：已实现
- [ ] **后台更新**：真正的后台更新
- [ ] **更新失败重试**：重试机制
- [ ] **更新通知**：完善通知

#### 4.2 增量更新
- [ ] **版本检测**：检测订阅版本
- [ ] **哈希比较**：使用哈希值比较
- [ ] **变更检测**：检测新增/删除/修改
- [ ] **增量合并**：只更新变更部分

#### 4.3 更新策略
- [ ] **连接时更新**：连接前自动更新
- [ ] **定时后台更新**：定期后台更新
- [ ] **手动刷新**：用户手动刷新
- [ ] **更新冲突处理**：更新时正在连接的处理

#### 4.4 更新通知
- [ ] **更新进度显示**：实时显示进度
- [ ] **更新结果通知**：成功/失败通知
- [ ] **更新日志**：记录更新历史

---

### 🎯 五、其他关键问题

#### 5.1 规则配置
- [ ] **规则文件管理**：本地/远程规则文件
- [ ] **规则更新机制**：自动更新规则
- [ ] **自定义规则**：用户自定义规则
- [ ] **规则测试**：测试规则有效性

#### 5.2 DNS 配置
- [ ] **DNS 服务器选择**：选择 DNS 服务器
- [ ] **DoH/DoT 支持**：支持加密 DNS
- [ ] **DNS 规则配置**：DNS 分流规则
- [ ] **DNS 缓存管理**：DNS 缓存

#### 5.3 流量统计
- [ ] **实时流量监控**：显示实时流量
- [ ] **历史流量统计**：历史数据
- [ ] **流量限制**：流量限制和提醒
- [ ] **流量图表**：可视化展示

#### 5.4 连接优化
- [ ] **连接池管理**：管理连接池
- [ ] **超时设置**：可配置超时
- [ ] **重连机制**：自动重连
- [ ] **连接质量监控**：监控连接质量

#### 5.5 安全性
- [ ] **数据加密**：敏感数据加密
- [ ] **本地存储加密**：加密本地存储
- [ ] **传输加密**：确保 HTTPS
- [ ] **日志脱敏**：日志中脱敏敏感信息

#### 5.6 性能优化
- [ ] **内存优化**：减少内存使用
- [ ] **CPU 优化**：减少 CPU 使用
- [ ] **电池优化**：减少电池消耗
- [ ] **启动速度**：优化启动时间

#### 5.7 错误处理
- [ ] **网络错误**：完善的网络错误处理
- [ ] **配置错误**：配置错误检测和处理
- [ ] **内核错误**：内核错误处理
- [ ] **用户友好提示**：友好的错误提示

#### 5.8 测试和调试
- [ ] **单元测试**：核心功能单元测试
- [ ] **集成测试**：集成测试
- [ ] **调试工具**：调试工具和界面
- [ ] **日志查看器**：日志查看界面

---

## 🎯 优先级分类

### P0 - 核心功能（必须实现）
1. ✅ 内核启动/停止（基础完成）
2. ✅ 配置格式转换（基础完成）
3. ⚠️ 完整配置生成（需要完善）
4. ⚠️ 无缝内核切换（需要实现）
5. ✅ 自动更新订阅（基础完成）
6. ✅ 状态持久化（基础完成）

### P1 - 重要功能（应该实现）
1. ⚠️ 进程监控和自动重启
2. ⚠️ 增量更新订阅
3. ⚠️ 规则配置管理
4. ⚠️ DNS 配置
5. ⚠️ 数据加密存储
6. ⚠️ 完整协议支持

### P2 - 增强功能（可以后续实现）
1. 流量统计
2. 连接优化
3. 高级特性支持
4. 性能优化
5. 测试和调试工具

---

## 📊 实现进度

### 已完成 ✅
- 内核基础功能
- 配置格式转换（基础）
- 自动更新订阅（基础）
- 状态持久化（基础）
- 存储服务
- 订阅更新器

### 进行中 ⚠️
- 完整配置生成
- 无缝内核切换
- 增量更新

### 待实现 ❌
- 进程监控
- 规则配置
- DNS 配置
- 流量统计
- 数据加密

---

**最后更新**：2024-12-22

